<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ü¶∑</title>
    <link rel="stylesheet" th:href="@{/css/style.css}" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>

<!-- üîù –ú–µ–Ω—é -->
<nav class="menu">
    <header><strong>ü¶∑ DENTAL MECHANIC SERVICE ü¶∑</strong></header>
    <a th:href="@{/main/dental-works/new}">NEW WORK</a>
    <a th:href="@{/main/dental-works}">WORK LIST</a>
    <a th:href="@{/main/product-map}">PRODUCT MAP</a>
    <a th:href="@{/main/user}">ACCOUNT</a>
    <a style="float:right;" th:href="@{/main/log-out}" onclick="return confirm('–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')">
        <button>–≤—ã–π—Ç–∏</button>
    </a>
</nav>

<section>
    <!-- üìÖ –ó–∞–≥–æ–ª–æ–≤–æ–∫ –º–µ—Å—è—Ü–∞ -->
    <h3><strong th:text="${headerMonth.value()}">–ò—é–ª—å - 2025</strong></h3>

    <!-- üü¶ –õ–µ–≥–µ–Ω–¥–∞ -->
    <h4 style="float: left;">
        <label style="background-color: #002d73; border: 5px solid #002d73">–í–´–ü–û–õ–ù–ï–ù–û</label> &emsp;
        <label style="background-color: #075700; border: 5px solid #075700">–û–ü–õ–ê–ß–ï–ù–û</label>
    </h4>

    <!-- üßæ –¢–∞–±–ª–∏—Ü–∞ -->
    <div class="table">
        <div class="thead" style="font-size: 65%;">
            <div class="tr">
                <div class="th">–ü–ê–¶–ò–ï–ù–¢</div>
                <div class="th">–ö–õ–ò–ù–ò–ö–ê</div>
                <div class="th" th:each="item : ${map}" th:text="${item.title.toUpperCase()}">–ü–†–û–î–£–ö–¢</div>
                <div class="th">–î–ê–¢–ê</div>
                <div class="th">–ü–†–ò–ù–Ø–¢–û</div>
            </div>
        </div>

        <div class="tbody">
            <a th:each="work : ${works}"
               th:class="${work.status == 'COMPLETED'} ? 'tr-closed' : (${work.status == 'PAID'} ? 'tr-paid' : 'tr')"
               th:href="@{'/main/dental-works/' + ${work.id}}">

                <div class="td" th:text="${work.patient}">–ü–∞—Ü–∏–µ–Ω—Ç</div>
                <div class="td" th:text="${work.clinic}">–ö–ª–∏–Ω–∏–∫–∞</div>

                <!-- –ü—Ä–æ–¥—É–∫—Ç—ã -->
                <div class="td"
                     th:each="item : ${map}"
                     th:text="${work.quantityFor(item.title) ?: ' '}">
                    0
                </div>

                <div class="td" th:text="${work.completeAt}">01-01-2000</div>
                <div class="td" th:text="${work.acceptedAt}">01-01-2000</div>
            </a>
        </div>
    </div>
    </div>
</section>

<!-- ‚è¨ –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é -->
<nav class="low-menu">
    <!-- PROFIT -->
    <a id="profit-label"><button>–ø–æ—Å—á–∏—Ç–∞—Ç—å –¥–æ—Ö–æ–¥</button></a>
    <div id="profit-form" style="display:none;">
        <form method="post" th:action="@{/main/profit}">
            <input class="medium-button" type="submit" value="—Ç–µ–∫—É—â–∏–π">
            <input type="hidden" name="year" th:value="${headerMonth.year}">
            <input type="hidden" name="month" th:value="${headerMonth.monthValue}">
        </form>
        <form method="post" th:action="@{/main/profit}">
            <input class="medium-button" type="submit" value="–∑–∞ –≤—Å—ë –≤—Ä–µ–º—è">
        </form>
    </div>

    <!-- SEARCH -->
    <a id="search-label"><button>–ø–æ–∏—Å–∫ –∑–∞–ø–∏—Å–∏</button></a>
    <div id="search-form" style="display:none;">
        <form method="post" th:action="@{/main/dental-works/search}">
            <input type="text" name="patient" placeholder="–ø–∞—Ü–∏–µ–Ω—Ç">
            <input type="text" name="clinic" placeholder="–∫–ª–∏–Ω–∏–∫–∞">
            <input class="medium-button" type="submit" value="–Ω–∞–π—Ç–∏">
        </form>
    </div>

    <!-- SELECT MONTH -->
    <a id="monthly-label"><button>–¥—Ä—É–≥–æ–π –º–µ—Å—è—Ü</button></a>
    <div id="monthly-form" style="display:none;">
        <form method="get" th:action="@{/main/dental-works}">
            <input type="month" name="year-month"
                   th:value="${headerMonth.year + '-' + headerMonth.monthValue}">
            <input class="medium-button" type="submit" value="–≤—ã–±—Ä–∞—Ç—å">
        </form>
    </div>

    <!-- SORT -->
    <a id="sort-label"><button>—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button></a>
    <div id="sort-form" style="display:none;">
        <form method="post" th:action="@{/main/dental-works/sorting}">
            <input type="hidden" name="year" th:value="${headerMonth.nowYear}">
            <input type="hidden" name="month" th:value="${headerMonth.nowMonthValue}">
            <input class="medium-button" type="submit" value="—Ç–µ–∫—É—â–∏–π">
        </form>
        <form method="post" th:action="@{/main/dental-works/sorting}">
            <input type="hidden" name="year" th:value="${headerMonth.prevYear}">
            <input type="hidden" name="month" th:value="${headerMonth.prevMonthValue}">
            <input class="medium-button" type="submit" value="–ø—Ä–æ—à–ª—ã–π">
        </form>
        <form method="post" th:action="@{/main/dental-works/sorting}">
            <input type="hidden" name="year" th:value="${headerMonth.year}">
            <input type="hidden" name="month" th:value="${headerMonth.monthValue}">
            <input type="hidden" name="method" value="put">
            <input class="medium-button" type="submit" value="–≤—Å–µ –æ–ø–ª–∞—á–µ–Ω—ã">
        </form>
    </div>

    <!-- DOWNLOAD -->
    <a>
        <form method="get" th:action="@{/dental/main/reports/download}">
            <input class="low-button" type="submit" value="—Å–∫–∞—á–∞—Ç—å">
            <input type="hidden" name="year" th:value="${headerMonth.year}">
            <input type="hidden" name="month" th:value="${headerMonth.monthValue}">
        </form>
    </a>
</nav>

<!-- ‚öôÔ∏è –°–∫—Ä–∏–ø—Ç—ã -->
<script>
    // –¢–∞–±–ª–∏—á–Ω—ã–µ —Ä—è–¥—ã ‚Äî –∫–ª–∏–∫ –ø–æ —Å—Ç—Ä–æ–∫–µ
    document.addEventListener('DOMContentLoaded', function () {
        document.querySelectorAll('.row-clickable').forEach(row => {
            row.addEventListener('click', () => {
                const href = row.getAttribute('data-href');
                if (href) window.location.href = href;
            });
        });

        // –ü–µ—Ä–µ–∫–ª—é—á–∞–ª–∫–∏ –≤ –Ω–∏–∂–Ω–µ–º –º–µ–Ω—é
        $('#search-label').click(() => $('#search-form').toggle("show"));
        $('#profit-label').click(() => $('#profit-form').toggle("show"));
        $('#sort-label').click(() => $('#sort-form').toggle("show"));
        $('#monthly-label').click(() => $('#monthly-form').toggle("show"));
    });
</script>

</body>
</html>
