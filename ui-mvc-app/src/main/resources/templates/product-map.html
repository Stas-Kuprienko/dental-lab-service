<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>DENTAL LAB SERVICE</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ü¶∑</text></svg>">
    <link rel="stylesheet" th:href="@{/css/style.css}" />
</head>

<body>
<!-- üîù –ú–µ–Ω—é -->
<div th:replace="fragments/nav :: main-menu"></div>

<section>
    <!-- üîß –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç -->
    <h3 style="text-align: left;">
        <a class="tr" id="product-new" style="cursor: pointer;">+ –ù–æ–≤—ã–π –ø—Ä–æ–¥—É–∫—Ç</a>
    </h3>

    <div id="product-form" style="display:none; margin-bottom: 1em;">
        <form method="post" th:action="@{/main/product-map}"
              style="display: flex; align-items: center; gap: 1em; flex-wrap: wrap;">
            <label for="title">–ø—Ä–æ–¥—É–∫—Ç:</label>
            <input id="title" type="text" name="title" required style="width: 160px; font-size: 16px;">

            <label for="price">—Ü–µ–Ω–∞:</label>
            <input id="price" type="number" name="price" min="0" required style="width: 100px; font-size: 16px;">

            <input type="submit" value="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å" style="font-size: 16px; font-weight: bold; height: 32px; width: 96px;">
        </form>
    </div>

    <!-- üìã –¢–∞–±–ª–∏—Ü–∞ -->
    <div class="table" style="width:75%;">
        <div class="thead">
            <div class="tr">
                <div class="th">–ü–†–û–î–£–ö–¢</div>
                <div class="th">–¶–ï–ù–ê</div>
                <div class="th"> </div>
            </div>
        </div>

        <div class="tbody">
            <div class="tr" th:each="item : ${map}" th:id="'row-' + ${item.id}">
                <div class="td" th:text="${item.title}">–Ω–∞–∑–≤–∞–Ω–∏–µ</div>

                <!-- üíµ –¶–µ–Ω–∞ -->
                <div class="td">
                    <!-- –ú–µ—Ç–∫–∞ -->
                    <span class="price-label" th:text="${item.price}"
                          th:attr="data-id=${item.id}, data-title=${item.title}">100</span>

                    <!-- –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
                    <form th:action="@{'/main/product-map/' + ${item.id} + '/edit'}" method="post"
                          class="price-form" style="display: none; margin-top: 4px;">
                        <input type="number" name="price" min="0" required
                               th:value="${item.price}" style="width: 70px; font-size: 14px;">

                        <input type="hidden" name="title" th:value="${item.title}">
                        <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button type="button" class="cancel-btn">–û—Ç–º–µ–Ω–∞</button>
                    </form>
                </div>

                <!-- ‚ùå –£–¥–∞–ª–µ–Ω–∏–µ -->
                <div class="td">
                    <form th:action="@{'/main/product-map/' + ${item.id} + '/delete'}" method="post"
                          onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç?')">
                        <button type="submit">–£–¥–∞–ª–∏—Ç—å</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- ‚úÖ –°—Ü–µ–Ω–∞—Ä–∏–∏ -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
      // –ü–æ–∫–∞–∑ / —Å–∫—Ä—ã—Ç–∏–µ —Ñ–æ—Ä–º—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ü–µ–Ω—ã
      document.querySelectorAll('.price-label').forEach(function (label) {
        label.addEventListener('click', function () {
          const rowId = label.getAttribute('data-id');
          const row = document.getElementById('row-' + rowId);
          const form = row.querySelector('.price-form');

          label.style.display = 'none';
          form.style.display = 'inline-block';
        });
      });

      // –ö–Ω–æ–ø–∫–∞ "–û—Ç–º–µ–Ω–∞" –≤ —Ñ–æ—Ä–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
      document.querySelectorAll('.cancel-btn').forEach(function (btn) {
        btn.addEventListener('click', function () {
          const form = btn.closest('.price-form');
          const row = form.closest('.tr');
          const label = row.querySelector('.price-label');

          form.style.display = 'none';
          label.style.display = 'inline';
        });
      });

      // –ü–æ–∫–∞–∑ —Ñ–æ—Ä–º—ã –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞
      const newBtn = document.getElementById('product-new');
      const newForm = document.getElementById('product-form');
      if (newBtn && newForm) {
        newBtn.addEventListener('click', function () {
          newForm.style.display = newForm.style.display === 'none' ? 'block' : 'none';
        });
      }
    });
</script>
</body>
</html>
